# Ejercicio 4: "*Unrestricted File Upload*"

**Nombre**: [Juan Ignacio Valdivia]

--- 
## Introduccion
Hemos enfatizado la importancia de ser extremadamente cautelosos en el manejo de la entrada de los usuarios, incluyendo los archivos. De hecho, la vulnerabilidad [*Unrestricted File Upload*](https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload), la cual corresponde a confiar plenamente en los archivos subidos por el usuario, puede tener consecuencias catastróficas.

El objetivo de este ejercicio es comprender bien las posibles **consecuencias** de un manejo de archivos "mediocre" y las formas de **prevenirlas**.

### Pregunta 1
Investigue y explique **con sus propias palabras** 3 posibles ataques que un usuario malicioso podria realizar a una aplicacion web con la vulnerabilidad *Unrestricted File Upload*". Se espera que para cada ataque se mencionen las **consecuencias** del mismo.

**Respuesta:**
- Web Shell:
    - Al estar permitida la subida de cualquier archivo es posible la subida de scripts de lado de servidor como php, java o python por ejemplo lo que hace muy simple la creación de un web shell. Un web shell es un script malicioso que permite al atacante ejecutar comandos directamente en el servidor utilizando HTTP requests al endpoint correcto.
    - Las consecuencias de este ataque son catastróficas, pues el atacante adquiere control completo sobre el servidor, pudiendo acceder a información sensible, implantando malware en los servicios web para afectar a los usuarios, entre otras cosas.
- Denegación de servicio:
    - Al no estar limitada la subida de archivos, es posible abusar de esto y tratar de dejar al servidor sin recursos.
    - Este ataque no genera de por sí no genera consecuencias tan graves como el del ataque anterior, pero si es posible que deje fuera de funcionamiento el servicio, al agotar los recursos del servidor este se va a ralentizar, evitando atender las solicitudes en un tiempo razonable e incluso es probable que este colapse y definitivamente estar fuera de servicio.
- Cross Site Scripting:
    - Además de subir scripts para correr de lado del servidor también podemos subir scripts para ejecutar del lado del cliente, es decir podemos subir un archivo javascript, html o una imagen svg y ocupar el tag "script" para crear un script xss que quede almacenado, el cual sí aparece en una página va a ser ejecutado por el cliente.
    - Con este método el atacante puede modificar el html, tener acceso a cualquier cookie, token de sesión u otra información confidencial almacenada por el navegador y/o utilizada en el sitio. Además es posible la
    redirección a otros sitios maliciosos.
### Pregunta 2
Ahora que ya tenemos claro que descuidar el manejo de archivos es peligroso, les pedimos listar 5 metodos preventivos para esta vulnerabilidad.

**Respuesta:**
- Chequear que las extensiones y mime types se encuentren dentro de una whitelist, ya que es más fácil admitir solo los archivos que queremos que tratar de rechazar una gran cantidad en una blacklist, ya que algunos archivos podrían pasar desapercibidos.
- Renombrar todos los archivos, eliminando caracteres especiales, para evitar cualquier tipo de ejecución de comandos o scripts.
- Limitar el tamaño máximo de un archivo para evitar que se realice un ataque de denegación de servicio.
- Remover el permiso de ejecución de código en los directorios donde se almacenen los archivos subidos por usuarios.
- De ser posible, almacenar los archivos subidos en un servidor con un dominio diferente, para así separar los servicios y mitigar el ataque en caso de fallar las verificaciones.






## Referencias
https://owasp.org/www-community/vulnerabilities/Unrestricted_File_Upload
https://portswigger.net/web-security/file-upload
Ejercicio 2